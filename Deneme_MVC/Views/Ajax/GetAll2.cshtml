@{
    ViewData["Title"] = "Hastane Listesi";
}

<h2>Hastane Listesi</h2>

<table id="hospitalTable" class="table table-bordered">
    <thead>
        <tr>
            <th>Hastane Id</th>
            <th>Hastane Adı</th>
            <th>Adres</th>
            <th>İşlemler</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="hospitalForm" style="margin-top: 20px;">
    <h3>Hastane Ekle</h3>
    <form id="addHospitalForm">
        <label for="name">Hastane Adı:</label>
        <input type="text" id="addName" name="name" required />
        <label for="address">Adres:</label>
        <input type="text" id="addAddress" name="address" required />
        <button type="button" onclick="addHospital()">Ekle</button>
    </form>

    <h3>Hastane Güncelle</h3>
    <form id="updateHospitalForm">
        <label for="updateId">Hastane Id:</label>
        <input type="number" id="updateId" name="updateId" required />
        <label for="updateName">Hastane Adı:</label>
        <input type="text" id="updateName" name="updateName" required />
        <label for="updateAddress">Adres:</label>
        <input type="text" id="updateAddress" name="updateAddress" required />
        <button type="button" onclick="updateHospital()">Güncelle</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        // Sayfa yüklendiğinde hastaneleri listele
        listHospitals();

        // Hastane ekleme işlemi
        window.addHospital = function () {
            var name = $("#addName").val();
            var address = $("#addAddress").val();

            $.ajax({
                type: "POST",
                url: "https://localhost:7133/api/Hastaneler/Add",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({ "Name": name, "Adres": address }),
                success: function () {
                    listHospitals();
                },
                error: function (data) {
                    //alert("Hata: " + data.responseText);
                }
            });
            
        };

        // Hastane güncelleme işlemi
        window.updateHospital = function () {
            var id = $("#updateId").val();
            var name = $("#updateName").val();
            var address = $("#updateAddress").val();

            $.ajax({
                type: "PUT",
                url: "https://localhost:7133/api/Hastaneler/Update?id=" + id,
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({ "Name": name, "Adres": address }),
                success: function () {
                    listHospitals();
                },
                error: function (data) {
                    //alert("Hata: " + data.responseText);
                }
            });
            
        };

        // Hastane silme işlemi
        window.deleteHospital = function (id) {
            $.ajax({
                type: "DELETE",
                url: "https://localhost:7133/api/Hastaneler/Delete?id=" + id,
                contentType: "application/json",
                dataType: "json",
                success: function () {
                    listHospitals();
                },
                error: function (data) {
                    //alert("Hata: " + data.responseText);
                }
            });
            
        };

        // Hastaneleri listeleme işlemi
        function listHospitals() {
            $.ajax({
                type: "GET",
                url: "https://localhost:7133/api/Hastaneler/getall",
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    // Tabloyu temizle
                    $("#hospitalTable tbody").empty();

                    // Hastaneleri tabloya ekle
                    $.each(data, function (index, hospital) {
                        var row = "<tr>" +
                            "<td>" + hospital.id + "</td>" +
                            "<td>" + hospital.hastaneAd + "</td>" +
                            "<td>" + hospital.hastaneAdres + "</td>" +
                            "<td>" +
                            "<button type='button' onclick='fillUpdateForm(" + hospital.id + ", \"" + hospital.hastaneAd + "\", \"" + hospital.hastaneAdres + "\")'>Güncelle</button> " +
                            "<button type='button' onclick='deleteHospital(" + hospital.id + ")'>Sil</button>" +
                            "</td>" +
                            "</tr>";

                        $("#hospitalTable tbody").append(row);

                    });
                },
                error: function (data) {
                    //alert("Hata: " + data.responseText);
                }
            });
        }

        // Güncelleme formunu doldurma işlemi
        window.fillUpdateForm = function (id, name, address) {
            $("#updateId").val(id);
            $("#updateName").val(name);
            $("#updateAddress").val(address);
        };
    });
</script>
